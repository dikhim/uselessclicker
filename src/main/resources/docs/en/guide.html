<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Guide</title>
</head>
<body>
<p><a href="#interface">Интерфейс</a><br/>
    <a href="#controlObjects">Объекты управления</a><br/>
    <a href="#firstScript">Первый скрипт</a><br/>
    <a href="#loops">Циклы</a><br/>
    <a href="#functions">Функции</a><br/>
    <a href="#classesAndObjects">Классы и объекты</a><br/>
    <a href="#keyAndMouseObjects">Работа с клавиатурой и мышью</a><br/>
    <a href="#mouseMovement">Перемещение курсора</a><br/>
    <a href="#delays">Задержки</a><br/>
    <a href="#delaySystem">Система задержек</a><br/>
    <a href="#speedAndMultiplier">Изменение скорости или множитель задержек</a><br/>
    <a href="#timeSynchronizationCombinedRun">Синхронизация затраченного времени в методе combined.run</a><br/><br/>
    <a href="#recording">Захват событий</a><br/><br/><br/>
    <a name="interface"></a><br/>
    <strong class="text-strong">Application interface</strong><br/>
    The upper control panel contains the basic controls for working with the application. <br/> At the center there are two text fields: upper one is for editing the script, which is executed by the application, and the lower one is used for system messages.
</p>
<ul>
    <li>New - to create new file</li>
    <li>open - to open an existing file</li>
    <li>Save - to save opened file. If a file was not been opened, then a window with a proposal to select a location for the new file will be shown</li>
    <li>Save as - to save 
        Сохр. как; сохранить скрипт в новом файле. Если до этого был открыт другой файл то открытый файл остается
        неизменным.
    </li>
    <li>Запуск; запустить скрипт находящийся в поле редактирования на обработку. Если до этого был запущен ругой
        скрипт то он будет экстренно приостановлен
    </li>
    <li>Стоп; приостановить запущенный скрипт</li>
    <li>Сервер; открыть окно для настройки и запуска сервера</li>
    <li>Настройки; открыть окно с основными настройками приложения</li>
    <li>О программе - открыть окно с информацие о программе и разработчиках</li>
</ul>
<p><a name="controlObjects"></a><br/><strong class="text-strong">Объекты управления</strong><br/>Для создания сценариев в приложение используется<strong
        class="text-strong">"JavaScript"</strong>под движком<strong class="text-strong">"Nashorn"</strong>. Это означает, что может использоваться полный синтаксис и библиотеки поддерживаемые данным движком. Полную информацию о поддерживаемых библиотеках и синтаксисе можете найти здесь ***.<br/>Для управления компьютером в окружение скрипта введены несколько основных объектов, которые отображаю основные элементы компьютера.<br/>Перечень доступных объектов:
</p>
<ul>
    <li>mouse - мышь</li>
    <li>key - клавиатура</li>
    <li>combined - комбинированный объект для работы с мышью и клавиатурой</li>
    <li>system - система</li>
    <li>clipboard - буфер обмена</li>
</ul>
<p>Доступ к параметрам и методом объекта осуществляется через оператор точку.<br/><br/><a
        name="firstScript"></a><br/><strong class="text-strong">Первый скрипт</strong><br/>Напишем первый скрипт. Вставьте следующий код в поле редактирования и выполните скрипт нажав кнопку "Запуск".
</p>
<div class="codebox">
    <p>CODE:<a href="https://3bytes.pp.ua/viewtopic.php?f=5&amp;t=4#"
                                  onclick="selectCode(this); return false;">SELECT ALL</a></p>
    <pre><code>system.println('Hello world);</code></pre>
</div>
<p>Если все сделано правильно, то вы увидите в поле вывода сообщение "Hello world". Системный объект содержит методы для работы с системой, такие как вывод системных сообщений или приостановка выполнения. При выводе сообщений сообщения выводятся и в стандартный поток вывода. Для проверки этого можете запустить приложение через консоль.<br/>Так что, для работы с любым из объектов можно выделить основный принцип доступа
</p>
<div class="codebox">
    <p>CODE:<a href="https://3bytes.pp.ua/viewtopic.php?f=5&amp;t=4#"
                                  onclick="selectCode(this); return false;">SELECT ALL</a></p>
    <pre><code>объект.метод('текстовый параметр',параметр);</code></pre>
</div>
<p>Полный список доступных объектов и их методов можно найти в документации либо пройти в правое меню в подпункт "Шаблоны", где можно вставить нужный шаблон и прочитать краткое описание для данного метода.<br/><br/><a
        name="loops"></a><br/>
<p><a name="functions"></a><br/><br/><br/><a
        name="classesAndObjects"></a><br/>
<p><a name="delays"></a><br/><strong class="text-strong"><br/><br/><a
        name="delaySystem"></a><br/>
<p><a name="combinedObject"></a><br/><strong class="text-strong">Объект combined</strong><br/>Данный объект служит для воспроизведения действий как мыши, так и клавиатуры одновременно. Основным его методом является метод<strong
        class="text-strong">run</strong>. Данный метод получает строку в качестве параметра. Строка представляет из себя компактную запись событий. В каждом символе передаваемой строки закодирован определенный передаваемый параметр. Кодировка происходит в символы юникода (в будущем и другие форматы).<br/><br/>Рассмотрим подробнее каждое возможное событие и их параметры.
</p>
<ul>
    <li>k# &ndash; key.press(#) зажать клавишу '#'</li>
    <li>K# &ndash; key.release(#) отпустить клавишу '#'</li>
    <li>l &ndash; mouse.press('LEFT') зажать левую кнопку мыши</li>
    <li>L &ndash; mouse.release('LEFT') отпустить левую кнопку мыши</li>
    <li>r &ndash; mouse.press('RIGHT') зажать правую кнопку мыши</li>
    <li>R &ndash; mouse.release('RIGHT') отпустить правую кнопку мыши</li>
    <li>m &ndash; mouse.press('MIDDLE') зажать среднюю кнопку мыши</li>
    <li>M &ndash; mouse.release('MIDDLE') отпустить среднюю кнопку мыши</li>
    <li>w# &ndash; mouse.wheel('DOWN',#) прокрутить колесико вниз '#'</li>
    <li>W# &ndash; mouse.wheel('UP',#) прокрутить колесико вверх '#'</li>
    <li>A#$ &ndash; mouse.moveTo(#,$) передвинуть курсор в точку (#,$)</li>
    <li>X#$ &ndash; mouse.move(#,$) передвинуть курсор на (#,$)</li>
    <li>d# &ndash; system.sleep(#) подождать '#' миллисекунд</li>
    <li>D# &ndash; system.sleep(#*1000) подождать '#' секунд</li>
</ul>
<p>Каждое событие записывается с определенной буквы. Некоторые события не имеют параметров(к примеру, зажать левую кнопку мыши), некоторые имеют один параметр(зажать клавишу '#'), а некоторые имеют два параметра (передвинуть курсор в точку (#,$)). При декодировании списка событий каждый из параметров преобразуется в числовое либо буквенное представление и вызывается соответствующий метод.<br/><br/><a
        name="timeSynchronizationCombinedRun"></a><br/><strong class="text-strong">Синхронизация затраченного времени в
    методе combined.run</strong><br/>Одной из особенностей метода<strong
        class="text-strong">run</strong>является то, что он проводит синхронизацию по времени выполнения скрипта и реально потраченного времени. Приведем пример: имеется список событий, где записаны различные действия<strong
        class="text-strong">"ld#Ld#k#d#K#d#"</strong>, используя список событий можно понять, что тут происходит нажатие и отпускание левой кнопки мыши и нажатие и отпускание какой-то клавиши клавиатуры. Переведем эту строку к более наглядному виду и заполним неизвестные параметры:
</p>
<div class="codebox">
    <p>CODE:<a href="https://3bytes.pp.ua/viewtopic.php?f=5&amp;t=4#"
                                  onclick="selectCode(this); return false;">SELECT ALL</a></p>
    <pre><code>"ld#Ld#k#d#K#d#" &gt;&gt;&gt;

mouse.press('LEFT');
system.sleep(30);
mouse.release('LEFT');
system.sleep(45);
key.press('A');
system.sleep(100);
key.release('A');
system.sleep(35);
</code></pre>
</div>
<p>Между каждым событием присутствует задержка. Теоретическое время выполнение скрипта будет равно сумме всех указанных задержек методом<strong
        class="text-strong">"system.sleep() &ndash; 30 + 45 + 100 +35 = 210мс"</strong>. Время за которое данный скрипт выполнится на самом деле, будет немного больше(плюс время выполнение самого скрипта), что будет вносить нежелательное отклонение от реального времени. Для компенсации этого отклонения оно вычитается из времени метода<strong
        class="text-strong">system.sleep()</strong>после каждого события. Внутренние задержки событий также вычитаются из времени задержки. Приведем пример.
</p>
<div class="codebox">
    <p>CODE:<a href="https://3bytes.pp.ua/viewtopic.php?f=5&amp;t=4#"
                                  onclick="selectCode(this); return false;">SELECT ALL</a></p>
    <pre><code>mouse.click('LEFT');
system.sleep(100);
</code></pre>
</div>
<p>Одно событие клика левой кнопкой мышью и задержка следующая после него. Как было описано в предыдущих главах, метод клика мышью уже содержит в себе стандартные задержки для нажатия кнопки мыши и ее отпускания со всей логикой их вычисления.<br/>Посчитаем время выполнения данного кода без компенсации задержек.<br/><br/><strong
        class="text-strong">(pressDelay =10, releaseDelay =10)<br/>mouse.click('LEFT'); -&gt; pressDelay + releaseDelay
    + 1(накладные расходы)<br/>system.sleep(100); -&gt; sleepTime + 1(накладные<br/>общее время = 10
    + 10 + 100 + 2(накладные расходы) =122 мс.<br/>указанное время = 100 мс.<br/>разница = 22
    мс.<br/></strong><br/><br/>По предварительному подсчету, в такой ситуации фактическое время выполнения будет не менее 120 мс., а с учетом накладных расходов и того больше. Программа при выполнении метода<strong
        class="text-strong">run</strong>компенсирует время выполнения отнимая нежелательную разницу из метода<strong
        class="text-strong">system.sleep()</strong>, фактически, будет выполнен следующий код.<br/>mouse.click('LEFT');<br/>system.sleep(78); // отнял 22 мс. разницы<br/>Таким образом, время выполнения скрипта будет соответствовать реальному времени. Но как всегда, есть ограничения.<br/>Что произойдет, если время самого события будет меньше чем доступное время для компенсации? Посмотрим на пример.
</p>
<div class="codebox">
    <p>CODE:<a href="https://3bytes.pp.ua/viewtopic.php?f=5&amp;t=4#"
                                  onclick="selectCode(this); return false;">SELECT ALL</a></p>
    <pre><code>(pressDelay =60, releaseDelay =60)

mouse.click('LEFT'); //60 + 60 + 1(накладные расходы)  =121 мс.
system.sleep(100); //100 + 1(накладные расходы) =101 мс.

общее время = 60 + 60 + 100 + 2= 222 мс.
указанное время= 100 мс.
разница = 122 мс.
</code></pre>
</div>
<p>В данной ситуации получается, что разница во времени больше, чем время, которое возможно компенсировать вычитанием из метода<strong
        class="text-strong">system.sleep()</strong>. Что же происходит в данной ситуации? Все просто, из метода<strong
        class="text-strong">system.sleep()</strong>вычитается максимально возможно время (100 мс.), а остаток будет вычтен из следующего события.
</p>
<div class="codebox">
    <p>CODE:<a href="https://3bytes.pp.ua/viewtopic.php?f=5&amp;t=4#"
                                  onclick="selectCode(this); return false;">SELECT ALL</a></p>
    <pre><code>mouse.click('LEFT'); 
system.sleep(0); // остаток 22 мс.
</code></pre>
</div>
<p>Если и из следующего события не получится вычесть нужное время, то остаток будет накапливаться, но он всегда будет ограничен параметром<strong
        class="text-strong">system.delayBuffer</strong>(стандартно<strong class="text-strong">delayBuffer</strong>= 100 мс.).<br/><br/><strong
        class="text-strong">Захват событий</strong><br/>Мы рассмотрели основные объекты для симуляция событий клавиатуры и мыши. Теперь рассмотрим механизм их простой записи.<br/>Все необходимые элементы управления для записи событий находятся в правом меню в пункте<strong
        class="text-strong">"Захват событий"</strong>.<br/>Элементы разделены на отдельные группы. На момент написания все элементы разделены на такие группы:
</p>
<ul>
    <li>Клавиатура. Захват только клавиатуры</li>
    <li>Мышь (основные)</li>
    <li>Мышь (кнопки, колесико)</li>
    <li>Мышь (клик)</li>
    <li>Мышь + клавиатура</li>
</ul>
<p>Для захвата события, выберите место, куда вы хотите вставить код, выберите нужны метод захвата, (используйте контрольную клавишу, если этого требует метод захвата), произведите нужные действия, включите захват событий.<br/><br/>Захват клавиатуры<br/>Особенность захвата клавиатуры в том, что при его включении отключается возможность редактировать скрипт с клавиатуры. Если его включить, то в вывод будут дублироваться клавиши. Так при наборе "hello world" с выбранным методом для вставки имен клавиш "Захват событий &gt; Клавиатура &gt; key name" в выводе будет "H E L O SPACE W O R L D" вместо "hH eE lL lL oO SPACE wW oO rR lL dD ".<br/>Отдельно нужно выделить метод для вставки имен клавиш. Он позволит не лезь в документацию, если вы забыли как называется нужная клавиша.<br/><br/>Захват мыши<br/>Особенность захвата мыши в использовании контрольной клавиши. По умолчанию контрольная клавиша "CONTROL", ее можно изменить в настройках.<br/>Для захвата мыши необходимо выбрать нужный метод, потом зажать контрольную клавишу и произвести необходимые действия, отпустить контрольную клавишу.<br/>Способ захвата с использованием контрольной клавиши выбран для того, чтобы было проще контролировать те события, которые должны попасть в вывод.<br/>Учтите, что во многих приложениях контрольная клавиша "CONTROL" будет работать некорректно, так как часто CONTROL в сочетании с кнопкой мыши уже зарезервирован для других действий. Потому, для каждого приложения вам придется подбирать свою контрольную клавишу, которая не будет конфликтовать с программой.<br/><br/>Захват клавиатура + мышь<br/>Наверное, один из самых мощных инструментов для записи действий пользователя. Он способен записать события клавиатуры и мыши, обработать их надлежащим образом и сохранить это все в компактное текстовое представление.<br/>Для активации комбинированной записи необходимо включить соответствующий элемент управления и нажать контрольную клавишу, которую можно установить в окне настроек.<br/>Запись событий начинается после отпускания контрольной клавиши, а прекращается по ее нажатию. Это позволяет избежать попадания событий контрольной клавиши в список записанных событий.<br/>В качестве контрольной клавиши возможно установить комбинацию клавиш, но стоит учитывать, что в таком случае в список записанных событий попадут события нажатия и отпускания из списка контрольных клавиш.<br/>Для управления записью событий существую несколько опций:
</p>
<ul>
    <li>Клавиши клавиатуры &ndash; Включить запись клавиатуры;</li>
    <li>Кнопки мыши &ndash; включить запись кнопок мыши;</li>
    <li>Колесико мыши &ndash; включить запись колесика мыши;</li>
    <li>Абсолютные координаты. Выбрав запись по абсолютным координатам в результат будут добавляться события для
        перемещения курсора в указанные координата, аналогично как для метода mouse.moveTo(x,y);
    </li>
    <li>Относительные координаты. Выбрав запись относительных координат в результат будут добавлены события для
        перемещения курсора относительно предыдущего события, аналогично как для метода mouse.move(dx,dy);
    </li>
    <li>Задержки. - включить в результат задержки между событиями</li>
    <li>"фиксированная частота" &ndash; включить запись с указанием фиксированной частоты записи событий передвижения
        мыши;
    </li>
    <li>"минимальное расстояние" &ndash; включить запись с указанием минимального расстояния между событиями
        передвижения мыши;
    </li>
    <li>"точки остановки" &ndash; включить запись с определением точек остановок.</li>
</ul>
<p>Подробнее остановимся на том, как работают последние три опции. Эти опции созданы для уменьшения объема кода. Если они выключены, то результат будет максимально приближен к действиям пользователя.<br/>Эти опции никоим образом не влияют на все события клавиатуры, колесика и клавиш мыши, а только отсеивают избыточные события перемещения мыши.<br/><br/>Опция "фиксированная частота" указывает максимальную частоту записи событий. Стандартно, курсор может изменять свое положения около 60-120 раз в секунду, что означает, что в результат каждую секунду будут добавлены 60-120 событий перемещения мыши. Указав значение равно 30, к примеру, их количество можно сократить в 4 раза. Чем ниже значение, тем больше событий будут опущены. Возможна ситуация, когда необходимое событие будет не записано.<br/>Данная опция позволяет сократить количество кода и полностью сохраняет скорость передвижения курсора. Если вы в водном месте двигали курсор быстро, а в другом медленно, то эта разница так же будет заметна. Если двигать курсор очень медленно, то данная опция не поможет сократить объем кода, так как все события так же будут попадать в результат.<br/><br/>Опция "Минимальное расстояние" указывает минимальное расстояние меду двумя событиями перемещения мыши. К примеру, минимальное расстояние установлено равным 100 пикселям, вы нажали кнопку мыши и теперь медленно ведете в сторону. Событие передвижения следующее за событием нажатия кнопки гарантировано в результат, однако в результат не попадет ни одно событие расстояние до которого будет меньше чем 100 пикселей.<br/>Эта опция так же поможет вам сократит объем кода. Она позволит убрать избыточные события вне зависимости от того быстро вы передвигаете мышь или очень медленно.<br/>Не рекомендуется устанавливать большие значения, так как результат может быть весьма непредсказуем.<br/><br/>Опция "точки остановки" позволить убрать недостатки от использования предыдущих двух опций. Если курсор простоял в данной точки не двигаясь дольше чем указанное количество мс., то события перемещения курсора в эту точку гарантировано попадет в результат.<br/>Таким образом, можно устанавливать любые значения для предыдущих двух опций и указывать особенно важные точки, которые обязательно должны попасть в результат, просто подержав курсов на месте некоторое время.<br/>Частота обновления стандартного монитора 60 или 120 герц, что дает примерно 8.3 и 16.6 мс. на кадр. Если вы визуально можете заметить, что курсор замер на месте, значит время его остановки было более 17 и 34 мс. соответственно. Указывать значения меньше чем время за 2 кадра нет смысла. Рекомендуется указывать время минимум за 4 кадра: 34 и 67 мс.
</p>
</body>
</html>